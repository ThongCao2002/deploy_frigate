import{u as y,c as N,f as T,h as n,o as e,H as c,d as j,A as H,k as O}from"./index-1b1f5707.js";function _(){const{data:r}=y("config"),{data:a}=y("exports/",t=>N({baseURL:T,url:t}).then(i=>i.data)),[d,k]=n("select"),[o,D]=n("select"),[u,s]=n({text:"",error:!1}),h=new Date;h.setHours(0,0,0,0);const C=h.getTimezoneOffset()*60*1e3,v=new Date(h.getTime()-C).toISOString().split("T")[0],[m,$]=n(v),[g,w]=n("00:00"),[p,S]=n(v),[x,z]=n("23:59"),E=()=>{if(d=="select"){s({text:"Cần chọn ít nhất 1 camera để thực thi.",error:!0});return}if(o=="select"){s({text:"Cần chọn định dạng phát lại.",error:!0});return}if(!m||!g||!p||!x){s({text:"Cần chọn thời gian bắt đầu và kết thúc",error:!0});return}const t=new Date(`${m}T${g}`).getTime()/1e3,i=new Date(`${p}T${x}`).getTime()/1e3;if(i<=t){s({text:"Thời gian kết thúc phải sau thời gian bắt đầu.",error:!0});return}N.post(`export/${d}/start/${t}/end/${i}`,{playback:o}).then(l=>{l.status==200&&s({text:"Bắt đầu xuất dữ liệu. Vui lòng xem kết quả trong thư mục /exports.",error:!1})}).catch(l=>{var f,b;(b=(f=l.response)==null?void 0:f.data)!=null&&b.message?s({text:`Xuất dữ liệu không thành công: ${l.response.data.message}`,error:!0}):s({text:`Xuất dữ liệu không thành công: ${l.message}`,error:!0})})};return e("div",{className:"space-y-4 p-2 px-4 w-full",children:[e(c,{children:"Xuất dữ liệu"}),u.text&&e("div",{className:`max-h-20 ${u.error?"text-red-500":"text-green-500"}`,children:u.text}),e("div",{className:"xl:flex justify-between",children:[e("div",{children:[e("div",{children:[e("select",{className:"me-2 cursor-pointer rounded dark:bg-slate-800",value:d,onChange:t=>k(t.target.value),children:[e("option",{value:"select",children:"Chọn camera"}),Object.keys((r==null?void 0:r.cameras)||{}).map(t=>e("option",{value:t,children:t.replaceAll("_"," ")},t))]}),e("select",{className:"ms-2 cursor-pointer rounded dark:bg-slate-800",value:o,onChange:t=>D(t.target.value),children:[e("option",{value:"select",children:"Chọn định dạng phát lại"}),e("option",{value:"realtime",children:"Thời gian thực"}),e("option",{value:"timelapse_25x",children:"Tua nhanh"})]})]}),e("div",{children:[e(c,{className:"py-2",size:"sm",children:"Từ:"}),e("input",{className:"dark:bg-slate-800",id:"startDate",type:"date",value:m,onChange:t=>$(t.target.value)}),e("input",{className:"dark:bg-slate-800",id:"startTime",type:"time",value:g,onChange:t=>w(t.target.value)}),e(c,{className:"py-2",size:"sm",children:"Đến:"}),e("input",{className:"dark:bg-slate-800",id:"endDate",type:"date",value:p,onChange:t=>S(t.target.value)}),e("input",{className:"dark:bg-slate-800",id:"endTime",type:"time",value:x,onChange:t=>z(t.target.value)})]}),e(j,{className:"my-4",onClick:()=>E(),children:"Gửi"})]}),a&&e("div",{className:"p-4 bg-gray-800 xl:w-1/2",children:[e(c,{size:"md",children:"Xuất dữ liệu"}),e(X,{exports:a})]})]})]})}function X({exports:r}){return e(O,{children:r.map(a=>e("div",{className:"my-4 p-4 bg-gray-700",children:a.name.startsWith("in_progress")?e("div",{className:"flex justify-start text-center items-center",children:[e("div",{children:e(H,{size:"sm"})}),e("div",{className:"px-2",children:a.name.substring(12,a.name.length-4)})]}):e("div",{className:"flex justify-start items-center",children:e("a",{className:"text-blue-500 hover:underline",href:`${T}exports/${a.name}`,download:!0,children:a.name.substring(0,a.name.length-4)})})},a.name))})}export{_ as default};
