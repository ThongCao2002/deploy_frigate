import{u as U,h as D,_ as Q,T as q,p as Se,y as Qe,o as e,x as H,M as ge,H as oe,d as C,l as et,F as G,k as se,A as we,m as A,S as tt,n as at,D as Oe,q as lt,r as Be,g as rt,i as Re,b as st,c as Y,$ as nt}from"./index-1b1f5707.js";import{L as it}from"./Link-0ea49822.js";import{V as ot}from"./VideoPlayer-101baef2.js";import{C as ct}from"./Calendar-518770d0.js";import{A as Ze,a as dt}from"./ArrowDropup-d791ab70.js";import{P as ut,f as re,g as ht}from"./Play-5837bbd3.js";import{T as mt}from"./TimeAgo-257a48f4.js";import{A as ft}from"./About-5c887223.js";import"./video.es-306ef4f3.js";import"./index-aa83c415.js";import"./ArrowRightDouble-efaefc73.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ve=function(){return ve=Object.assign||function(s){for(var r,n=1,c=arguments.length;n<c;n++){r=arguments[n];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(s[l]=r[l])}return s},ve.apply(this,arguments)};function pt(t,s,r,n){function c(l){return l instanceof r?l:new r(function(w){w(l)})}return new(r||(r=Promise))(function(l,w){function d(p){try{o(n.next(p))}catch(u){w(u)}}function b(p){try{o(n.throw(p))}catch(u){w(u)}}function o(p){p.done?l(p.value):c(p.value).then(d,b)}o((n=n.apply(t,s||[])).next())})}function bt(t,s){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},n,c,l,w;return w={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(w[Symbol.iterator]=function(){return this}),w;function d(o){return function(p){return b([o,p])}}function b(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,c&&(l=o[0]&2?c.return:o[0]?c.throw||((l=c.return)&&l.call(c),0):c.next)&&!(l=l.call(c,o[1])).done)return l;switch(c=0,l&&(o=[o[0]&2,l.value]),o[0]){case 0:case 1:l=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,c=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!l||o[1]>l[0]&&o[1]<l[3])){r.label=o[1];break}if(o[0]===6&&r.label<l[1]){r.label=l[1],l=o;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(o);break}l[2]&&r.ops.pop(),r.trys.pop();continue}o=s.call(t,r)}catch(p){o=[6,p],c=0}finally{n=l=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}var gt=function(){},Ue=gt(),_e=Object,Z=function(t){return t===Ue},Me=function(t){return typeof t=="function"},wt="undefined",vt=function(){return typeof window!=wt},xt=!vt()||"Deno"in window,Ve=xt?Se:Qe,fe=new WeakMap,yt=0,De=function(t){var s=typeof t,r=t&&t.constructor,n=r==Date,c,l;if(_e(t)===t&&!n&&r!=RegExp){if(c=fe.get(t),c)return c;if(c=++yt+"~",fe.set(t,c),r==Array){for(c="@",l=0;l<t.length;l++)c+=De(t[l])+",";fe.set(t,c)}if(r==_e){c="#";for(var w=_e.keys(t).sort();!Z(l=w.pop());)Z(t[l])||(c+=l+":"+De(t[l])+",");fe.set(t,c)}}else c=n?t.toJSON():s=="symbol"?t.toString():s=="string"?JSON.stringify(t):""+t;return c},Te=function(t){if(Me(t))try{t=t()}catch{t=""}var s=[].concat(t);t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?De(t):"";var r=t?"$swr$"+t:"";return[t,s,r]},_t=function(t){return Me(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}]},Nt=function(t,s){return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var c=_t(r),l=c[0],w=c[1],d=c[2],b=(d.use||[]).concat(s);return t(l,w,ve(ve({},d),{use:b}))}},St="$inf$",Dt=function(t){return Te(t?t(0,null):null)[0]},Tt=function(t){return function(s,r,n){var c=D({})[1],l=Q(!1),w=Q(),d=n.cache,b=n.initialSize,o=b===void 0?1:b,p=n.revalidateAll,u=p===void 0?!1:p,v=n.persistSize,x=v===void 0?!1:v,W=n.revalidateFirstPage,ee=W===void 0?!0:W,K=n.revalidateOnMount,J=K===void 0?!1:K,j=null;try{j=Dt(s)}catch{}var f=null,m=null;j&&(f="$ctx$"+j,m="$len$"+j);var _=q(function(){var y=d.get(m);return Z(y)?o:y},[m,o]),S=Q(_());Ve(function(){if(!l.current){l.current=!0;return}j&&d.set(m,x?S.current:o)},[j]);var I=J&&!l.current,M=t(j?St+j:null,function(){return pt(void 0,void 0,void 0,function(){var y,N,z,$,k,R,O,V,te,ae,B,de;return bt(this,function(L){switch(L.label){case 0:y=d.get(f)||[],N=y[0],z=y[1],$=[],k=_(),R=null,O=0,L.label=1;case 1:return O<k?(V=Te(s(O,R)),te=V[0],ae=V[1],te?(B=d.get(te),de=u||N||Z(B)||ee&&!O&&!Z(w.current)||I||z&&!Z(z[O])&&!n.compare(z[O],B),r&&de?[4,r.apply(void 0,ae)]:[3,3]):[3,5]):[3,5];case 2:B=L.sent(),d.set(te,B),L.label=3;case 3:$.push(B),R=B,L.label=4;case 4:return++O,[3,1];case 5:return d.delete(f),[2,$]}})})},n);Ve(function(){w.current=M.data},[M.data]);var E=q(function(){for(var y=[],N=0;N<arguments.length;N++)y[N]=arguments[N];var z=y[0],$=y[1]!==!1;if(f){if($)if(Z(z))d.set(f,[!0]);else{var k=w.current;d.set(f,[!1,k])}return y.length?M.mutate(z,$):M.mutate()}},[f]),ne=function(y){for(var N=[],z=null,$=0;$<y;++$){var k=Te(s($,z))[0],R=k?d.get(k):Ue;if(Z(R))return w.current;N.push(R),z=R}return N},ce=q(function(y){if(m){var N;if(Me(y)?N=y(_()):typeof y=="number"&&(N=y),typeof N=="number")return d.set(m,N),S.current=N,c({}),E(ne(N))}},[m,_,E]);return{size:_(),setSize:ce,mutate:E,get error(){return M.error},get data(){return M.data},get isValidating(){return M.isValidating}}}},kt=Nt(U,Tt);function ke({className:t="h-6 w-6",stroke:s="currentColor",fill:r="none",onClick:n=()=>{}}){return e("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:r,viewBox:"0 0 24 24",stroke:s,onClick:n,children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}H(ke);function $e({className:t="h-6 w-6",stroke:s="currentColor",onClick:r=()=>{}}){return e("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:s,onClick:r,children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}H($e);function ze({className:t="h-6 w-6",stroke:s="currentColor",fill:r="none",onClick:n=()=>{}}){return e("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:r,viewBox:"0 0 24 24",stroke:s,onClick:n,children:[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}H(ze);function We({className:t="h-6 w-6",stroke:s="currentColor",fill:r="none",onClick:n=()=>{}}){return e("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:r,viewBox:"0 0 24 24",stroke:s,onClick:n,children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}H(We);function Ke({className:t="h-6 w-6",stroke:s="currentColor",fill:r="none",onClick:n=()=>{}}){return e("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:r,viewBox:"0 0 24 24",stroke:s,onClick:n,children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}H(Ke);function Je({className:t="h-6 w-6",stroke:s="currentColor",fill:r="none",onClick:n=()=>{}}){return e("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:r,viewBox:"0 0 24 24",stroke:s,onClick:n,children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}H(Je);function $t({className:t="h-6 w-6",stroke:s="currentColor",fill:r="none",onClick:n=()=>{}}){return e("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:r,viewBox:"0 0 24 24",stroke:s,onClick:n,children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}const Mt=H($t);function zt({className:t="h-7 w-7",stroke:s="currentColor",onClick:r=()=>{}}){return e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 32 32",stroke:s,onClick:r,className:t,children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round",strokeWidth:"2",d:"M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z"})})}const Ct=H(zt);function pe({className:t,title:s,options:r,selection:n,onToggle:c,onShowAll:l,onSelectSingle:w}){const d=Q(null),[b,o]=D({showMenu:!1}),p=x=>n=="all"||n.split(",").indexOf(x)>-1,u=Math.round(window.innerHeight*.55),{data:v}=U("config");return e("div",{className:`${t} p-2`,ref:d,children:[e("div",{className:"flex justify-between min-w-[120px]",onClick:()=>o({showMenu:!0}),children:[e("label",{children:s}),e(Ze,{className:"w-6"})]}),b.showMenu?e(ge,{className:`max-h-[${u}px] overflow-auto`,relativeTo:d,onDismiss:()=>o({showMenu:!1}),children:[e("div",{className:"flex flex-wrap justify-between items-center",children:[e(oe,{className:"p-4 justify-center",size:"md",children:s}),e(C,{tabindex:"false",className:"mx-4",onClick:()=>l(),children:"Hiển thị tất cả"})]}),r.map(x=>e("div",{className:"flex flex-grow",children:[e("label",{className:"flex flex-shrink space-x-2 p-1 my-1 min-w-[176px] hover:bg-gray-200 dark:hover:bg-gray-800 dark:hover:text-white cursor-pointer capitalize text-sm",children:[e("input",{className:"mx-4 m-0 align-middle",type:"checkbox",checked:p(x),onChange:()=>c(x)}),x.replaceAll("_"," ")]}),e("div",{className:"justify-right",children:e(C,{color:p(x)?"blue":"black",type:"text",className:"max-h-[35px] mx-2",onClick:()=>w(x),children:s==="Labels"&&v.audio.listen.includes(x)?e(Ct,{}):e(et,{})})})]},x))]}):null]})}const jt=({dateRange:t,onChange:s})=>{const[r,n]=D(null),[c,l]=D(new Set),[w,d]=D(null),[b,o]=D(!1),p=G(()=>t.before?new Date(t.before):new Date(new Date().setHours(24,0,0,0)),[t]),u=G(()=>t.after?new Date(t.after):new Date(new Date().setHours(0,0,0,0)),[t]);Se(()=>{if(p.getHours()===0&&u.getHours()===0&&c.size>1)return l(new Set)},[u,p,c]),Se(()=>{if(b||!u)return;const m=Math.max(p.getDate()-u.getDate())*24,_=p.getHours()?m+p.getHours():0;for(let S=u.getHours();S<_;S++)l(I=>I.add(S));if(c.size>1){const S=document.getElementById(`timeIndex-${Math.max(...c)}`);S&&S.scrollIntoViewIfNeeded(!0)}},[u,p,c,b]);const v=G(()=>new Set([...Array(Math.max(1,p.getDate()-u.getDate()+1))].map((f,m)=>u.getDate()+m)),[p,u]);p.getHours()===0&&v.delete(p.getDate());const x=G(()=>Array.from({length:v.size*24},(f,m)=>m%24),[v]),W=q(f=>{if(isNaN(f))return;const m=new Set([...c]);if(m.add(f),n(null),c.has(f)){l(new Set),o(!0);const _=p.setDate(u.getDate()+v.size-1);return s({after:u.setHours(0,0,0,0)/1e3,before:new Date(_).setHours(24,0,0,0)/1e3})}if(m.size===1){if(Math.ceil(Math.max(...m))>23)return n("Select a time on the initial day!");const S=new Date(u).setHours(Math.min(...m));let I=p;v.size===1&&(I=new Date(u).setHours(Math.min(...m)+1)),s({after:S/1e3,before:I/1e3})}if(m.size>1){let _=Math.ceil(Math.max(...m)/24);if(f===24&&_===v.size-1&&(_+=1),_!==v.size)return n("Ending must occur on final day!");const S=Math.min(...m);if(f<=S)return n("Ending hour must be greater than start time!");for(let M=S;M<=f;M++)m.add(M);const I=new Date(t.after);s({after:t.after/1e3,before:I.setHours(Math.max(...m)+1)/1e3})}for(let _=0;_<m.size;_++)l(S=>S.add(Array.from(m)[_]))},[u,p,c,t.after,v.size,s]),ee=q(f=>!!c.has(f),[c]),K=q(f=>c.size===1&&f>Math.max(...c)&&f<=w,[c,w]),J="bg-blue-600 transition duration-300 ease-in-out hover:rounded-none";function j(f){const m=["bg-[#212529]/50","bg-[#343a40]/50","bg-[#495057]/50","bg-[#666463]/50","bg-[#817D7C]/50","bg-[#73706F]/50","bg-[#585655]/50","bg-[#4F4D4D]/50","bg-[#454343]/50","bg-[#363434]/50"];return m[f%m.length]}return e(se,{children:[r?e("span",{className:"text-red-400 text-center text-xs absolute top-1 right-0 pr-2",children:r}):null,e("div",{className:"mt-2 pr-3 hidden xs:block","aria-label":"Calendar timepicker, select a time range",children:[e("div",{className:"flex items-center justify-center",children:e(dt,{className:"w-10 text-center"})}),e("div",{className:"w-20 px-1",children:[e("div",{className:"border border-gray-400/50 cursor-pointer hide-scroll shadow-md rounded-md",style:{maxHeight:"17rem",overflowY:"scroll"},children:x.map((f,m)=>e("div",{id:`timeIndex-${m}`,className:`${ee(m)?J:""}
                ${K(m)?"opacity-30 bg-slate-900 transition duration-150 ease-in-out":""}
                ${Math.min(...c)===m?"rounded-t-lg":""}
                ${c.size>1&&Math.max(...c)===m?"rounded-b-lg":""}`,onMouseEnter:()=>d(m),onMouseLeave:()=>d(null),children:e("div",{className:`
            text-gray-300 w-full font-light border border-transparent hover:border hover:rounded-md hover:border-gray-600 text-center text-sm
            ${j([Math.floor(m/24)])}`,onClick:()=>W(m),children:e("span",{"aria-label":`${m}:00`,children:[x[m],":00"]})})},m))}),e("div",{className:"flex items-center justify-center",children:e(Ze,{className:"w-10 text-center"})})]})]})]})},qt=jt;function Et({className:t=""}){return e("svg",{className:`fill-current ${t}`,viewBox:"0 -960 960 960",children:e("path",{fill:"currentColor",d:"M360-80q-58 0-109-22t-89-60q-38-38-60-89T80-360q0-81 42-148t110-102q20-39 49.5-68.5T350-728q33-68 101-110t149-42q58 0 109 22t89 60q38 38 60 89t22 109q0 85-42 150T728-350q-20 39-49.5 68.5T610-232q-35 68-102 110T360-80Zm0-80q33 0 63.5-10t56.5-30q-58 0-109-22t-89-60q-38-38-60-89t-22-109q-20 26-30 56.5T160-360q0 42 16 78t43 63q27 27 63 43t78 16Zm120-120q33 0 64.5-10t57.5-30q-59 0-110-22.5T403-403q-38-38-60.5-89T320-602q-20 26-30 57.5T280-480q0 42 15.5 78t43.5 63q27 28 63 43.5t78 15.5Zm120-120q18 0 34.5-3t33.5-9q22-60 6.5-115.5T621-621q-38-38-93.5-53.5T412-668q-6 17-9 33.5t-3 34.5q0 42 15.5 78t43.5 63q27 28 63 43.5t78 15.5Zm160-78q20-26 30-57.5t10-64.5q0-42-15.5-78T741-741q-27-28-63-43.5T600-800q-35 0-65.5 10T478-760q59 0 110 22.5t89 60.5q38 38 60.5 89T760-478Z"})})}const Ft=H(Et);function Pt({className:t=""}){return e("svg",{className:`fill-current ${t}`,viewBox:"0 0 24 24",children:e("path",{d:"M22 12l-4-4v3h-8v2h8v3m2 2a10 10 0 110-12h-2.73a8 8 0 100 12z"})})}const At=H(Pt);function Ht({className:t=""}){return e("svg",{className:`fill-current ${t}`,viewBox:"0 -960 960 960",children:e("path",{fill:"currentColor",d:"M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"})})}const It=H(Ht);function Ot({event:t,onFrameSelected:s}){const{data:r}=U(["timeline",{source_id:t.id}]),{data:n}=U("config"),c=G(()=>{var u,v;return n?(((v=(u=n.cameras[t.camera])==null?void 0:u.detect)==null?void 0:v.annotation_offset)||0)/1e3:0},[n,t]),[l,w]=D(-1),d={before:t.end_time||Date.now(),after:t.start_time},{data:b}=U([`${t.camera}/recordings`,d],{revalidateOnFocus:!1}),o=u=>{if(!b)return 0;let v=0;return b.every(x=>x.start_time>u?!1:x.end_time<u?(v+=x.end_time-x.start_time,!0):(v+=x.end_time-x.start_time-(x.end_time-u),!0)),v},p=async u=>{w(u),s(r[u],o(r[u].timestamp+c))};return!r||!n?e(we,{}):r.length==0?e("div",{}):e("div",{className:"flex flex-col",children:[e("div",{className:"h-14 flex justify-center",children:e("div",{className:"sm:w-1 md:w-1/4 flex flex-row flex-nowrap justify-between overflow-auto",children:r.map((u,v)=>e(C,{className:"rounded-full",type:"iconOnly",color:v==l?"blue":"gray","aria-label":window.innerWidth>640?Rt(n,u,t):"",onClick:()=>p(v),children:Bt(u.class_type)},v))})}),l>=0?e("div",{className:"m-2 max-w-md self-center",children:e("div",{className:"flex justify-start",children:[e("div",{className:"text-lg flex justify-between py-4",children:"Bounding boxes may not align"}),e(C,{className:"rounded-full",type:"text",color:"gray","aria-label":" Disclaimer: This data comes from the detect feed but is shown on the recordings, it is unlikely that the streams are perfectly in sync so the bounding box and the footage will not line up perfectly. The annotation_offset field can be used to adjust this.",children:e(ft,{className:"w-4"})})]})}):null]})}function Bt(t){switch(t){case"visible":return e(ut,{className:"w-8"});case"gone":return e(At,{className:"w-8"});case"active":return e(Ft,{className:"w-8"});case"stationary":return e(It,{className:"w-8"});case"entered_zone":return e(ze,{className:"w-8"})}}function Rt(t,s,r){switch(s.class_type){case"visible":return`${r.label} detected at ${re(s.timestamp,{date_style:"short",time_style:"medium",time_format:t.ui.time_format})}`;case"entered_zone":return`${r.label.replaceAll("_"," ")} entered ${s.data.zones.join(" and ").replaceAll("_"," ")} at ${re(s.timestamp,{date_style:"short",time_style:"medium",time_format:t.ui.time_format})}`;case"active":return`${r.label} became active at ${re(s.timestamp,{date_style:"short",time_style:"medium",time_format:t.ui.time_format})}`;case"stationary":return`${r.label} became stationary at ${re(s.timestamp,{date_style:"short",time_style:"medium",time_format:t.ui.time_format})}`;case"gone":return`${r.label} left at ${re(s.timestamp,{date_style:"short",time_style:"medium",time_format:t.ui.time_format})}`}}function Vt({eventOverlay:t,cameraConfig:s}){const r=Math.round(t.data.box[0]*100),n=Math.round(t.data.box[1]*100),c=Math.round((1-t.data.box[2]-t.data.box[0])*100),l=Math.round((1-t.data.box[3]-t.data.box[1])*100),[w,d]=D(!1),b=()=>r<15?{left:`${r+t.data.box[2]*100+1}%`,top:`${n}%`}:{right:`${c+t.data.box[2]*100+1}%`,top:`${n}%`},o=()=>{const u=t.data.box[2]*s.detect.width,v=t.data.box[3]*s.detect.height;return Math.round(u*v)},p=()=>{const u=t.data.box[2]*s.detect.width,v=t.data.box[3]*s.detect.height;return Math.round(100*(u/v))/100};return e(se,{children:[e("div",{className:"absolute border-4 border-red-600",onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),onTouchStart:()=>d(!0),onTouchEnd:()=>d(!1),style:{left:`${r}%`,top:`${n}%`,right:`${c}%`,bottom:`${l}%`},children:t.class_type=="entered_zone"?e("div",{className:"absolute w-2 h-2 bg-yellow-500 left-[50%] -translate-x-1/2 translate-y-3/4 bottom-0"}):null}),w&&e("div",{className:"absolute bg-white dark:bg-slate-800 p-4 block dark:text-white text-lg",style:b(),children:[e("div",{children:`Area: ${o()} px`}),e("div",{children:`Ratio: ${p()}`})]})]})}const Le=25,be=t=>{let s=new Date;return s.setDate(s.getDate()-t),new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime()/1e3},Ne=t=>{let s=new Date;return s.setMonth(s.getMonth()-t),new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime()/1e3};function ta({path:t,...s}){var Ce,je;const r=st(),{data:n}=U("config"),c=G(()=>{var i;return((i=n==null?void 0:n.ui)==null?void 0:i.timezone)||Intl.DateTimeFormat().resolvedOptions().timeZone},[n]),[l,w]=D({before:null,after:null,cameras:s.cameras??"all",labels:s.labels??"all",zones:s.zones??"all",sub_labels:s.sub_labels??"all",time_range:"00:00,24:00",timezone:c,favorites:s.favorites??0,event:s.event}),[d,b]=D({showDownloadMenu:!1,showDatePicker:!1,showCalendar:!1,showPlusSubmit:!1}),[o,p]=D({id:null,label:null,validBox:null}),[u,v]=D([]),[x,W]=D(),[ee,K]=D(),[J,j]=D("clip"),[f,m]=D({id:null,label:null,box:null,has_clip:!1,has_snapshot:!1,plus_id:void 0,end_time:null}),[_,S]=D({deletingFavoriteEventId:null,showDeleteFavorite:!1}),I=q((i,h)=>l.event?(i=`${i}/${l.event}`,Y.get(i).then(g=>[g.data])):(h={...h,include_thumbnails:0,limit:Le},Y.get(i,{params:h}).then(g=>g.data)),[l]),M=q((i,h)=>{if(i>0){const g=h[h.length-1].start_time;return["events",{...l,before:g}]}return["events",l]},[l]),{data:E,mutate:ne,size:ce,setSize:y,isValidating:N}=kt(M,I),{data:z}=U(["labels"]),{data:$}=U(["sub_labels",{split_joined:1}]),k=G(()=>({cameras:Object.keys((n==null?void 0:n.cameras)||{}),zones:[...Object.values((n==null?void 0:n.cameras)||{}).reduce((i,h)=>(i=i.concat(Object.keys((h==null?void 0:h.zones)||{})),i),[]).filter((i,h,g)=>g.indexOf(i)===h),"None"],labels:Object.values(z||{}),sub_labels:($||[]).length>0?[...Object.values($),"None"]:[]}),[n,z,$]),R=async(i,h,g)=>{i.stopPropagation();let a;g?a=await Y.post(`events/${h}/retain`):a=await Y.delete(`events/${h}/retain`),a.status===200&&ne()},O=async(i,h,g)=>{i.stopPropagation(),g?S({deletingFavoriteEventId:h,showDeleteFavorite:!0}):(await Y.delete(`events/${h}`)).status===200&&ne()},V=(i,h)=>{let g;if(l[i]=="all"){const a=Array.from(k[i]);a.length>1?(a.splice(a.indexOf(h),1),g=a.join(",")):g=["all"]}else{let a=l[i].length>0?l[i].split(","):[];a.includes(h)?(a.length>1&&a.splice(a.indexOf(h),1),g=a.join(",")):a.length+1==k[i].length?g=["all"]:(a.push(h),g=a.join(","))}F(i,g)},te=(i,h,g)=>{this.player&&(this.player.pause(),this.player.currentTime(g),K(h))},ae=Q(),B=Q(),de=(i,h)=>{i.stopPropagation(),m(g=>{var a;return{id:h.id,box:((a=h==null?void 0:h.data)==null?void 0:a.box)||h.box,label:h.label,has_clip:h.has_clip,has_snapshot:h.has_snapshot,plus_id:h.plus_id,end_time:h.end_time}}),B.current=i.target,b({...d,showDownloadMenu:!0})},L=(i,h,g,a)=>{a&&a.stopPropagation(),p({id:i,label:h,validBox:!g.some(T=>T>1)}),b({...d,showDownloadMenu:!1,showPlusSubmit:!0})},X=q(i=>{w({...l,before:i.before,after:i.after}),b({...d,showDatePicker:!1})},[l,w,d,b]),Xe=q(i=>{w({...l,time_range:i})},[l]),F=q((i,h)=>{const g={...l,[i]:h};w(g);const a=Object.keys(g).map(T=>g[T]&&g[T]!="all"?`${T}=${g[T]}`:null).filter(T=>T).join("&");nt(`${t}?${a}`)},[t,l,w]),xe=(((Ce=E==null?void 0:E[E.length-1])==null?void 0:Ce.length)??0)<Le,ue=Q(),Ye=q(i=>{N||(ue.current&&ue.current.disconnect(),ue.current=new IntersectionObserver(h=>{h[0].isIntersecting&&!xe&&y(ce+1)}),i&&ue.current.observe(i))},[ce,y,N,xe]),ye=async(i,h,g)=>{if(u.includes(i))return;v(T=>[...T,i]);const a=h?await Y.put(`events/${i}/false_positive`):await Y.post(`events/${i}/plus`,g?{include_annotation:1}:{});a.status===200&&ne(T=>T.map(ie=>ie.map(le=>le.id===i?{...le,plus_id:a.data.plus_id}:le)),!1),v(T=>T.filter(ie=>ie!==i)),d.showDownloadMenu&&f.id===i&&b({...d,showDownloadMenu:!1}),b({...d,showPlusSubmit:!1})},Ge=i=>{j(i==0?"clip":"image")};if(!n)return e(we,{});const he={car:"Ô tô",motorcycle:"Xe máy",person:"Người",handbag:"Túi xách"};return e("div",{className:"space-y-4 p-2 px-4 w-full",children:[e(oe,{children:"SỰ KIỆN"}),e("div",{className:"flex flex-wrap gap-2 items-center",children:[e(pe,{className:"basis-1/5 cursor-pointer rounded dark:bg-slate-800",title:"Cameras",options:k.cameras,selection:l.cameras,onToggle:i=>V("cameras",i),onShowAll:()=>F("cameras",["all"]),onSelectSingle:i=>F("cameras",i)}),e(pe,{className:"basis-1/5 cursor-pointer rounded dark:bg-slate-800",title:"Nhãn",options:k.labels,selection:l.labels,onToggle:i=>V("labels",i),onShowAll:()=>F("labels",["all"]),onSelectSingle:i=>F("labels",i)}),e(pe,{className:"basis-1/5 cursor-pointer rounded dark:bg-slate-800",title:"Vùng",options:k.zones,selection:l.zones,onToggle:i=>V("zones",i),onShowAll:()=>F("zones",["all"]),onSelectSingle:i=>F("zones",i)}),k.sub_labels.length>0&&e(pe,{className:"basis-1/5 cursor-pointer rounded dark:bg-slate-800",title:"Sub Labels",options:k.sub_labels,selection:l.sub_labels,onToggle:i=>V("sub_labels",i),onShowAll:()=>F("sub_labels",["all"]),onSelectSingle:i=>F("sub_labels",i)}),l.event&&e(C,{className:"ml-2",onClick:()=>F("event",null),type:"text",children:"Xem tất cả"}),e(ke,{className:"h-10 w-10 text-yellow-300 cursor-pointer ml-auto",onClick:()=>F("favorites",l.favorites?0:1),fill:l.favorites==1?"currentColor":"none"}),e("div",{ref:ae,className:"ml-right",children:e(Mt,{className:"h-8 w-8 cursor-pointer",onClick:()=>b({...d,showDatePicker:!0})})})]}),d.showDownloadMenu&&e(ge,{onDismiss:()=>b({...d,showDownloadMenu:!1}),relativeTo:B,children:[f.has_snapshot&&e(A,{icon:tt,label:"Tải hình chụp",value:"snapshot",href:`${r}/api/events/${f.id}/snapshot.jpg?download=true`,download:!0}),f.has_clip&&e(A,{icon:at,label:"Tải video mô tả",value:"clip",href:`${r}/api/events/${f.id}/clip.mp4?download=true`,download:!0}),(((je=event==null?void 0:event.data)==null?void 0:je.type)||"object")=="object"&&f.end_time&&f.has_snapshot&&!f.plus_id&&e(A,{icon:$e,label:u.includes(f.id)?"Uploading...":"Send to Frigate+",value:"plus",onSelect:()=>L(f.id,f.label,f.box)}),f.plus_id&&e(A,{icon:$e,label:"Sent to Frigate+",value:"plus",onSelect:()=>b({...d,showDownloadMenu:!1})})]}),d.showDatePicker&&e(ge,{className:"rounded-t-none",onDismiss:()=>b({...d,setShowDatePicker:!1}),relativeTo:ae,children:[e(A,{label:"Tất cả",value:{before:null,after:null},onSelect:X}),e(A,{label:"Hôm nay",value:{before:null,after:be(0)},onSelect:X}),e(A,{label:"Hôm qua",value:{before:be(0),after:be(1)},onSelect:X}),e(A,{label:"Trong 7 ngày",value:{before:null,after:be(7)},onSelect:X}),e(A,{label:"Tháng này",value:{before:null,after:Ne(0)},onSelect:X}),e(A,{label:"Tháng trước",value:{before:Ne(0),after:Ne(1)},onSelect:X}),e(A,{label:"Tùy chọn",value:"custom",onSelect:()=>{b({...d,showCalendar:!0,showDatePicker:!1})}})]}),d.showCalendar&&e("span",{children:e(ge,{className:"rounded-t-none",onDismiss:()=>b({...d,showCalendar:!1}),relativeTo:ae,children:e(ct,{onChange:X,dateRange:{before:l.before*1e3||null,after:l.after*1e3||null},close:()=>b({...d,showCalendar:!1}),children:e(qt,{timeRange:l.time_range,onChange:Xe})})})}),d.showPlusSubmit&&e(Oe,{children:n.plus.enabled?e(se,{children:[e("div",{className:"p-4",children:[e(oe,{size:"lg",children:"Submit to Frigate+"}),e("img",{className:"flex-grow-0",src:`${r}/api/events/${o.id}/snapshot.jpg`,alt:`${o.label}`}),o.validBox?e("p",{className:"mb-2",children:"Objects in locations you want to avoid are not false positives. Submitting them as false positives will confuse the model."}):e("p",{className:"mb-2",children:"Events prior to version 0.13 can only be submitted to Frigate+ without annotations."})]}),o.validBox?e("div",{className:"p-2 flex justify-start flex-row-reverse space-x-2",children:[e(C,{className:"ml-2",onClick:()=>b({...d,showPlusSubmit:!1}),type:"text",children:u.includes(o.id)?"Close":"Cancel"}),e(C,{className:"ml-2",color:"red",onClick:()=>ye(o.id,!0,o.validBox),disabled:u.includes(o.id),type:"text",children:["This is not a ",o.label]}),e(C,{className:"ml-2",color:"green",onClick:()=>ye(o.id,!1,o.validBox),disabled:u.includes(o.id),type:"text",children:["This is a ",o.label]})]}):e("div",{className:"p-2 flex justify-start flex-row-reverse space-x-2",children:[e(C,{className:"ml-2",onClick:()=>b({...d,showPlusSubmit:!1}),disabled:u.includes(o.id),type:"text",children:u.includes(o.id)?"Close":"Cancel"}),e(C,{className:"ml-2",onClick:()=>ye(o.id,!1,o.validBox),disabled:u.includes(o.id),type:"text",children:"Submit to Frigate+"})]})]}):e(se,{children:[e("div",{className:"p-4",children:[e(oe,{size:"lg",children:"Setup a Frigate+ Account"}),e("p",{className:"mb-2",children:"In order to submit images to Frigate+, you first need to setup an account."}),e("a",{className:"text-blue-500 hover:underline",href:"https://plus.frigate.video",target:"_blank",rel:"noopener noreferrer",children:"https://plus.frigate.video"})]}),e("div",{className:"p-2 flex justify-start flex-row-reverse space-x-2",children:e(C,{className:"ml-2",onClick:()=>b({...d,showPlusSubmit:!1}),type:"text",children:"Close"})})]})}),_.showDeleteFavorite&&e(Oe,{children:[e("div",{className:"p-4",children:[e(oe,{size:"lg",children:"Delete Saved Event?"}),e("p",{className:"mb-2",children:"Confirm deletion of saved event."})]}),e("div",{className:"p-2 flex justify-start flex-row-reverse space-x-2",children:e(C,{className:"ml-2",color:"red",onClick:i=>{S({...d,showDeleteFavorite:!1}),O(i,_.deletingFavoriteEventId,!1)},type:"text",children:"Delete"})})]}),e("div",{className:"space-y-2",children:E?E.map((i,h)=>{const g=E.length===h+1;return i.map((a,T)=>{var le,qe,Ee,Fe,Pe,Ae,He,Ie;const ie=g&&i.length===T+1;return e(se,{children:[e("div",{ref:ie?Ye:!1,className:"flex bg-slate-100 dark:bg-slate-800 rounded cursor-pointer min-w-[330px]",onClick:()=>x===a.id?W(null):W(a.id),children:[e("div",{className:"relative rounded-l flex-initial min-w-[125px] h-[125px] bg-contain bg-no-repeat bg-center",style:{"background-image":`url(${r}/api/events/${a.id}/thumbnail.jpg)`},children:[e(ke,{className:"h-6 w-6 text-yellow-300 absolute top-1 right-1 cursor-pointer",onClick:P=>R(P,a.id,!a.retain_indefinitely),fill:a.retain_indefinitely?"currentColor":"none"}),a.end_time?null:e("div",{className:"bg-slate-300 dark:bg-slate-700 absolute bottom-0 text-center w-full uppercase text-sm rounded-bl",children:"Đang xử lý"})]}),e("div",{className:"m-2 flex grow",children:[e("div",{className:"flex flex-col grow",children:[e("div",{className:"capitalize text-lg font-bold",children:[he[a.label.replaceAll("_"," ")],a.sub_label?`: ${he[a.sub_label.replaceAll("_"," ")]}`:null]}),e("div",{className:"text-sm flex",children:[e(We,{className:"h-5 w-5 mr-2 inline"}),re(a.start_time,{...n.ui}),e("div",{className:"hidden md:inline",children:[e("span",{className:"m-1",children:"-"}),e(mt,{time:a.start_time*1e3,dense:!0})]}),e("div",{className:"hidden md:inline",children:[e("span",{className:"m-1"}),"( ",ht(a.start_time,a.end_time)," )"]})]}),e("div",{className:"capitalize text-sm flex align-center mt-1",children:[e(lt,{className:"h-5 w-5 mr-2 inline"}),a.camera.replaceAll("_"," ")]}),a.zones.length?e("div",{className:"capitalize  text-sm flex align-center",children:[e(ze,{className:"w-5 h-5 mr-2 inline"}),a.zones.join(", ").replaceAll("_"," ")]}):null,e("div",{className:"capitalize  text-sm flex align-center",children:[e(Be,{className:"w-5 h-5 mr-2 inline"}),(((le=a==null?void 0:a.data)==null?void 0:le.top_score)||a.top_score||0)==0?null:`${he[a.label]}: ${((((qe=a==null?void 0:a.data)==null?void 0:qe.top_score)||a.top_score)*100).toFixed(0)}%`,(((Ee=a==null?void 0:a.data)==null?void 0:Ee.sub_label_score)||0)==0?null:`, ${he[a.sub_label]}: ${(((Fe=a==null?void 0:a.data)==null?void 0:Fe.sub_label_score)*100).toFixed(0)}%`]}),e("div",{className:"capitalize  text-sm flex align-center",children:[e(Be,{className:"w-5 h-5 mr-2 inline"}),(Ae=(Pe=a==null?void 0:a.data)==null?void 0:Pe.attributes[0])==null?void 0:Ae.text]})]}),e("div",{class:"hidden sm:flex flex-col justify-end mr-2",children:a.end_time&&a.has_snapshot&&(((He=a==null?void 0:a.data)==null?void 0:He.type)||"object")=="object"&&e(se,{children:a.plus_id?e("div",{className:"uppercase text-xs underline",children:e(it,{href:`https://plus.frigate.video/dashboard/edit-image/?id=${a.plus_id}`,target:"_blank",rel:"nofollow",children:"Edit in Frigate+"})}):e(C,{color:"gray",disabled:u.includes(a.id),onClick:P=>{var me;return L(a.id,a.label,((me=a==null?void 0:a.data)==null?void 0:me.box)||a.box,P)},children:u.includes(a.id)?"Uploading...":"Send to Frigate+"})})}),e("div",{class:"flex flex-col",children:[e(Ke,{className:"h-6 w-6 cursor-pointer",stroke:"#f87171",onClick:P=>O(P,a.id,a.retain_indefinitely)}),e(Je,{className:"h-6 w-6 mt-auto",stroke:a.has_clip||a.has_snapshot?"#3b82f6":"#cbd5e1",onClick:P=>de(P,a)})]})]})]}),x!==a.id?null:e("div",{className:"space-y-4",children:e("div",{className:"mx-auto max-w-7xl",children:[e("div",{className:"flex justify-center w-full py-2",children:e(rt,{selectedIndex:a.has_clip&&J=="clip"?0:1,onChange:Ge,className:"justify",children:[e(Re,{text:"Video mô tả",disabled:!a.has_clip}),e(Re,{text:a.has_snapshot?"Hình chụp":"Hình đại diện"})]})}),e("div",{children:[J=="clip"&&a.has_clip?e("div",{children:[e(Ot,{event:a,onFrameSelected:(P,me)=>te(a,P,me)}),e("div",{children:e(ot,{options:{preload:"auto",autoplay:!0,sources:[{src:`${r}vod/event/${a.id}/master.m3u8`,type:"application/vnd.apple.mpegurl"}]},seekOptions:{forward:10,backward:5},onReady:P=>{this.player=P,this.player.on("playing",()=>{K(void 0)})},onDispose:()=>{this.player=null},children:ee?e(Vt,{eventOverlay:ee,cameraConfig:n.cameras[a.camera]}):null})})]}):null,J=="image"||!a.has_clip?e("div",{className:"flex justify-center",children:e("img",{className:"flex-grow-0",src:a.has_snapshot?`${r}/api/events/${a.id}/snapshot.jpg`:`${r}/api/events/${a.id}/thumbnail.jpg`,alt:`${a.label} at ${((((Ie=a==null?void 0:a.data)==null?void 0:Ie.top_score)||a.top_score)*100).toFixed(0)}% confidence`})}):null]})]})})]},a.id)})}):e(we,{})}),e("div",{children:xe?null:e(we,{})})]})}export{ta as default};
